{% extends 'base.html.twig' %}
{% block title %}Dashboard - TicketFlow{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/css/dashboard.css" />
{% endblock %}

{% block content %}
<div class="dashboard-page">
  <header class="dashboard-header animated-fadeIn">
    <div class="container">
      <div class="header-content">
        <h1 class="dashboard-title animated-slideDown">Dashboard Overview</h1>
        <div class="header-actions">
          <a href="/tickets" class="quick-action-btn animated-bounce">+ New Ticket</a>
          <form method="POST" action="/logout" style="display:inline;">
            <button type="submit" class="logout-btn animated-pulse">Logout</button>
          </form>
        </div>
      </div>
    </div>
  </header>

  <main class="dashboard-main">
    <section class="stats-section animated-slideUp delay-1">
      <div class="container">
        <h2 class="section-title animated-fadeIn">Ticket Statistics</h2>
        <div class="stats-grid">
          <div class="stat-item" onclick="showToast('Total tickets: {{ stats.total }}')">
            <div class="stat-icon">Chart</div>
            <h3>Total Tickets</h3>
            <p class="stat-number animated-zoomIn">{{ stats.total }}</p>
            <div class="stat-bar animated-fill"><div class="bar-fill" style="width:100%"></div></div>
          </div>
          <div class="stat-item" onclick="showToast('Open tickets: {{ stats.open }}')">
            <div class="stat-icon">Red Circle</div>
            <h3>Open Tickets</h3>
            <p class="stat-number animated-zoomIn open-color">{{ stats.open }}</p>
            <div class="stat-bar animated-fill"><div class="bar-fill open" style="width:{{ (stats.open / stats.total * 100)|round(1) }}%"></div></div>
          </div>
          <div class="stat-item" onclick="showToast('In Progress: {{ stats.in_progress }}')">
            <div class="stat-icon">Yellow Circle</div>
            <h3>In Progress</h3>
            <p class="stat-number animated-zoomIn in-progress-color">{{ stats.in_progress }}</p>
            <div class="stat-bar animated-fill"><div class="bar-fill in_progress" style="width:{{ (stats.in_progress / stats.total * 100)|round(1) }}%"></div></div>
          </div>
          <div class="stat-item" onclick="showToast('Closed: {{ stats.closed }}')">
            <div class="stat-icon">Green Circle</div>
            <h3>Closed Tickets</h3>
            <p class="stat-number animated-zoomIn closed-color">{{ stats.closed }}</p>
            <div class="stat-bar animated-fill"><div class="bar-fill closed" style="width:{{ (stats.closed / stats.total * 100)|round(1) }}%"></div></div>
          </div>
        </div>
      </div>
    </section>

    <section class="recent-tickets-section animated-slideUp delay-2">
      <div class="container">
        <h2 class="section-title animated-fadeIn">Recent Tickets</h2>
        <div class="tickets-table">
          <table class="tickets-table-header">
            <thead><tr><th>ID</th><th>Title</th><th>Status</th><th>Priority</th><th>Assigned To</th><th>Date</th></tr></thead>
          </table>
          <div class="tickets-body">
            {% for ticket in recent_tickets %}
            <div class="ticket-row animated-slideLeft">
              <span class="ticket-cell">{{ ticket.id }}</span>
              <span class="ticket-cell title-cell">{{ ticket.title }}</span>
              <span class="ticket-cell status-cell {{ ticket.status }}">{{ ticket.status|replace({'_': ' '})|title }}</span>
              <span class="ticket-cell priority-cell {{ ticket.priority }}">{{ ticket.priority|title }}</span>
              <span class="ticket-cell">{{ ticket.assigned_to }}</span>
              <span class="ticket-cell">{{ ticket.date }}</span>
            </div>
            {% else %}
            <div class="ticket-row"><span class="ticket-cell" colspan="6">No tickets yet.</span></div>
            {% endfor %}
          </div>
        </div>
        <div class="section-actions">
          <a href="/tickets" class="view-all-btn animated-bounce">View All Tickets</a>
        </div>
      </div>
    </section>

    <section class="quick-actions-section animated-slideUp delay-3">
      <div class="container">
        <h2 class="section-title animated-fadeIn">Quick Actions</h2>
        <div class="actions-grid">
          <a href="/tickets" class="action-card animated-rotateIn">
            <div class="action-icon">Plus</div><h3>Create New Ticket</h3><p>Start a new ticket quickly</p>
          </a>
          <div class="action-card animated-rotateIn" onclick="showToast('Search feature coming soon!')">
            <div class="action-icon">Magnifying Glass</div><h3>Search Tickets</h3><p>Find and filter tickets</p>
          </div>
          <div class="action-card animated-rotateIn" onclick="showToast('Assign feature coming soon!')">
            <div class="action-icon">People</div><h3>Assign Ticket</h3><p>Delegate tasks to team</p>
          </div>
          <div class="action-card animated-rotateIn" onclick="showToast('Report generation coming soon!')">
            <div class="action-icon">Chart</div><h3>Generate Report</h3><p>Export analytics</p>
          </div>
        </div>
      </div>
    </section>

    <section class="user-profile-section animated-slideUp delay-4">
      <div class="container">
        <h2 class="section-title animated-fadeIn">User Profile</h2>
        <div class="profile-card animated-bounceIn">
          <div class="profile-avatar animated-spin">User</div>
          <h3 class="profile-name">Welcome, {{ profile.name|default('User') }}!</h3>
          <p class="profile-email">{{ profile.email|default('user@example.com') }}</p>
          <div class="profile-stats">
            <span class="profile-stat">Tickets Assigned: 5</span>
            <span class="profile-stat">Tickets Resolved: 12</span>
          </div>
          <button class="profile-btn animated-pulse" onclick="document.getElementById('profile-modal').style.display='flex'">Edit Profile</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Logout Modal -->
  <div id="logout-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content animated-bounceIn">
      <h3>Confirm Logout</h3>
      <p>Are you sure you want to log out?</p>
      <div class="modal-actions">
        <form method="POST" action="/logout" style="display:inline;">
          <button type="submit" class="modal-btn confirm">Yes</button>
        </form>
        <button type="button" class="modal-btn cancel" onclick="this.closest('.modal-overlay').style.display='none'">No</button>
      </div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div id="profile-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content animated-bounceIn">
      <h3>Edit Profile</h3>
      <form method="POST" action="/dashboard/profile">
        <div class="form-group">
          <label>Name</label>
          <input type="text" name="name" value="{{ profile.name|default('') }}" placeholder="Enter your name" />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" name="email" value="{{ profile.email|default('') }}" placeholder="Enter your email" />
        </div>
        <div class="modal-actions">
          <button type="submit" class="modal-btn confirm">Save</button>
          <button type="button" class="modal-btn cancel" onclick="this.closest('.modal-overlay').style.display='none'">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <div class="decorative-circle animated-float" style="top:15%;left:8%;width:280px;height:280px;"></div>
  <div class="decorative-circle secondary-circle animated-float"></div>

  <svg class="wave-background" viewBox="0 0 1440 320" preserveAspectRatio="none">
    <path fill="#0056b3" fill-opacity="0.8" d="M0,160L48,176C96,192,192,224,288,213.3C384,203,480,149,576,133.3C672,117,768,139,864,149.3C960,160,1056,160,1152,144C1248,128,1344,96,1392,80L1440,64L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
  </svg>

  {% include 'footer.html.twig' %}
</div>

<script>
function showToast(msg) {
  const toast = document.createElement('div');
  toast.textContent = msg;
  toast.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:12px 24px;border-radius:8px;z-index:10000;animation:fadeIn 0.3s, fadeOut 0.3s 2.7s forwards;';
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}
document.querySelector('.logout-btn').addEventListener('click', (e) => {
  e.preventDefault();
  document.getElementById('logout-modal').style.display = 'flex';
});
</script>

<style>
@keyframes fadeOut { to { opacity: 0; } }
</style>
{% endblock %}